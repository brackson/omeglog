var Omegle = Class.extend({
  init: function() {
    $("#omegle_image").remove();

    $('a.new-image').addClass("disabled");
    $('a.new-image').text("Finding...");
    $("a.button.report").removeClass('disabled');
  },

  fetch: function() {
    $.ajax({
      async: true,
      url: "random_omeglog",
      dataType: "json",
      success: function(data){
        var img = $('<img id="omegle_image">');
        img.attr('src', "http://l.omegle.com/" + data['url'] + ".png");
        img.attr('img-id', data['url']);
        $("#log").append(img);

        $('a.new-image').text("Generate a New Image");
        $("a.new-image").removeClass("disabled");
      },
      error: function (request, status, error) {
      	window.location.replace("/");
      }
    });
  }
});

$(function() {
  if (typeof Cookies.get('accepted_disclaimer') === 'undefined') {
    $('#modal').foundation('open');

    $('#modal button span').on('click keyup', function() {
      Cookies.set('accepted_disclaimer', 'true', { expires: 365 });
      console.log('clicked 8)');
    });
  }

  $("a.button.new-image").on('click keyup', function() {
    console.log('clicked');
    var omeglog = new Omegle();
    omeglog.fetch();
  });

  $("a.button.report").on('click keyup', function() {
    $.ajax({
      url : "report_omeglog",
      type: "POST",
      data : {url: $('img#omegle_image').attr('img-id')},
      success: function(data, textStatus, jqXHR) {
        var box = '<div class="callout small"><h5>Thanks!</h5><p>This log will be reviewed.</p></div>';
        $('div.sidebar').append(box)
        $('div.sidebar div.callout.small').hide().fadeIn(1000);

        setTimeout(function() {
          $('div.callout.small').fadeOut(1000);
        }, 2000);
      }
    });
    $(this).text('Reported');
    $(this).addClass('disabled');
  });

  // $("a.button.share").on('click keyup', function(e) {
  //   e.preventDefault();
  //   var loc = window.location.href;
  //   var title  = encodeURIComponent($(this).attr('title'));
  //   window.open('http://twitter.com/share?text=' + $('img#omegle_image').attr('src') + ' via ' + '&url=' + loc +
  //     '&', 'twitterwindow', 'height=450, width=550, top='+($(window).height()/2 - 225) +
  //     ', left='+$(window).width()/2 +', toolbar=0, location=0, menubar=0, directories=0, scrollbars=0');
  // });

});
